<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Live Chat IRL - TV</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body class="tv">
  <div id="wall"></div>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    const socket = io();
    const wall = document.getElementById("wall");

    socket.on("message", (msg) => {
        // If message contains media and optional text, render text above media in one container.
        // If it's text-only, keep previous behavior.

        // TEXT-ONLY
        if (msg.type === "text") {
          const el = document.createElement("div");
          el.className = "message";
          el.textContent = msg.content;
          wall.appendChild(el);
        }

        // IMAGE (may include msg.text)
        if (msg.type === "image") {
          const container = document.createElement('div');
          // if there's text, render it above the image
          if (msg.text) {
            const t = document.createElement('div');
            t.className = 'message';
            t.textContent = msg.text;
            container.appendChild(t);
          }

          const img = document.createElement("img");
          img.src = msg.content;
          img.className = "image";
          container.appendChild(img);

          wall.appendChild(container);
        }

        // YOUTUBE (may include msg.text)
        if (msg.type === "youtube") {
          const container = document.createElement('div');
          if (msg.text) {
            const t = document.createElement('div');
            t.className = 'message';
            t.textContent = msg.text;
            container.appendChild(t);
          }

          const iframe = document.createElement("iframe");

          // taille comme les images selon si c'est un short ou pas
          console.log("msg.vertical", msg.vertical);
          if (msg.vertical === true) {
            iframe.width = "180"; // ou adapte selon ton CSS
            iframe.height = "320"; // ratio 9:16
          } else {
            iframe.width = "320"; // ou adapte selon ton CSS
            iframe.height = "180"; // ratio 16:9
          }

          iframe.src = `https://www.youtube.com/embed/${msg.content}?autoplay=1&mute=1&controls=0&modestbranding=1&rel=0&playlist=${msg.content}&loop=1`;
          iframe.allow = "autoplay; encrypted-media";
          iframe.style.border = "none";
          iframe.style.margin = "10px";
          iframe.style.borderRadius = "8px";
          iframe.className = "image"; // pour r√©utiliser le style image

          container.appendChild(iframe);
          wall.appendChild(container);
        }

    });
  </script>
</body>
</html>
